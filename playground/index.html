<html>
  <head>
    <script src="../llama/lex.js"></script>
    <script src="../llama/parse.js"></script>
    <script src="../llama/evaluate.js"></script>
    <script src="../llama/builtins.js"></script>
    <script src="../llama/xml.js"></script>
    <script>
var calculated = {};

function onToggle() {
    const radios  = document.getElementsByName("showWhat"),
          display = document.getElementById("output");

    radios.forEach(radio => {
        if (radio.checked) {
            display.value = calculated[radio.value] || "";
        }
    });
}

function pprint(value) {
    return JSON.stringify(value, null, 2);
}

function onInput() {
   const entry   = document.getElementById("input"),
         display = document.getElementById("output");
    try {
        const input = entry.value;

        const tokens = Lex.tokens(input);
        calculated.tokens = pprint(tokens);
        onToggle();

        const tree = Parse.parse(tokens);
        calculated.parse = pprint(tree);
        onToggle();

        const value = Evaluate.evaluate(tree, Builtins.defaultEnvironment);
        calculated.evaluate = pprint(value);
        onToggle();

        const node = Xml.toNode(value);
        calculated.nodes = pprint(node);
        onToggle();

        const text = Xml.toXml(node);
        calculated.text = pprint(text);
        onToggle();

        display.style.backgroundColor = '';
    }
    catch (error) {
        display.style.backgroundColor = '#FFF0F0';
        throw error;
    }
}
    </script>
  </head>
  <body>
    <table width="100%">
      <tr>
        <td>
          <textarea cols="80" rows="30" autofocus
                    id="input"
                    oninput="onInput()">Input goes here.</textarea>
        </td>
        <td>
          <textarea cols="80" rows="30" readonly
                    id="output">Output appears here.</textarea>
        </td>
      </tr>
      <tr>
        <td></td>
        <td>
          <form>
            <input type="radio"     name="showWhat" onchange="onToggle()"
                   value="tokens"   id="radioTokens">
            <label for="radioTokens">Tokens</label>

            <input type="radio"     name="showWhat" onchange="onToggle()"
                   value="parse"    id="radioParse">
            <label for="radioParse">Parse Tree</label>

            <input type="radio"     name="showWhat" onchange="onToggle()"
                   value="evaluate" id="radioEvaluate">
            <label for="radioEvaluate">Evaluated Tree</label>

            <input type="radio"     name="showWhat" onchange="onToggle()"
                   value="nodes"    id="radioNodes">
            <label for="radioNodes">XML Nodes</label>

            <input type="radio"     name="showWhat" onchange="onToggle()"
                   value="text"     id="radioText"  checked>
            <label for="radioText">XML Text</label>
          </form>
        </td>
      </tr>
    </table>
  </body>
</html>