<html>
  <head>
    <script src="../llama/lex.js"></script>
    <script src="../llama/parse.js"></script>
    <script src="../llama/evaluate.js"></script>
    <script src="../llama/builtins.js"></script>
    <script src="../llama/xml.js"></script>
    <script>
var calculated;

function onToggle() {
    const radios  = document.getElementsByName("showWhat"),
          display = document.getElementById("output");

    radios.forEach(radio => {
        if (radio.checked) {
            display.value = calculated[radio.value];
        }
    });
}

function pprint(value) {
    return JSON.stringify(value, null, 2);
}

function onInput() {
   const entry   = document.getElementById("input"),
         display = document.getElementById("output");
    try {
        const input  = entry.value,
              tokens = Lex.tokens(input),
              tree   = Parse.parse(tokens),
              value  = Evaluate.evaluate(tree, Builtins.defaultEnvironment),
              node   = Xml.toNode(value),
              text   = Xml.toXml(node);

         calculated = {
             tokens:   pprint(tokens),
             parse:    pprint(tree),
             evaluate: pprint(value),
             nodes:    pprint(node),
             text
         }               

        display.style.backgroundColor = '';
        onToggle();
    }
    catch (error) {
        display.style.backgroundColor = '#FFF0F0';
        throw error;
    }
}
    </script>
  </head>
  <body>
    <table width="100%">
      <tr>
        <td>
          <textarea cols="80" rows="30" autofocus
                    id="input"
                    oninput="onInput()">Input goes here.</textarea>
        </td>
        <td>
          <textarea cols="80" rows="30" readonly
                    id="output">Output appears here.</textarea>
        </td>
      </tr>
      <tr>
        <td></td>
        <td>
          <form>
            <input type="radio"     name="showWhat" onchange="onToggle()"
                   value="tokens"   id="radioTokens">
            <label for="radioTokens">Tokens</label>

            <input type="radio"     name="showWhat" onchange="onToggle()"
                   value="parse"    id="radioParse">
            <label for="radioParse">Parse Tree</label>

            <input type="radio"     name="showWhat" onchange="onToggle()"
                   value="evaluate" id="radioEvaluate">
            <label for="radioEvaluate">Evaluated Tree</label>

            <input type="radio"     name="showWhat" onchange="onToggle()"
                   value="nodes"    id="radioNodes">
            <label for="radioNodes">XML Nodes</label>

            <input type="radio"     name="showWhat" onchange="onToggle()"
                   value="text"     id="radioText"  checked>
            <label for="radioText">XML Text</label>
          </form>
        </td>
      </tr>
    </table>
  </body>
</html>